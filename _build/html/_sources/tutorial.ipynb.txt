{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Building a Recommender System from Scratch"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Step 1: Import Dependencies\n",
    "\n",
    "We are using [pandas.DataFrame](http://pandas.pydata.org/pandas-docs/version/0.19/generated/pandas.DataFrame.html) to represent our data. We will visualize our data with [matplotlib](https://matplotlib.org/) and [seaborn](https://seaborn.pydata.org/).\n",
    "\n",
    "**What is a DataFrame?**\n",
    "\n",
    "- a two-dimensional Pandas data structure\n",
    "- columns represent features, rows represent items\n",
    "- analogous to an Excel spreadsheet or SQL table\n",
    "- documentation can be found here"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "import pandas as pd\n",
    "import matplotlib.pyplot as plt\n",
    "import seaborn as sns"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Step 2: Load Data"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Let's download a small version of the MovieLens dataset. See here for zip file url, or directly download here. We're working with data in ml-latest-small.zip and will need to add the following files to our repository:\n",
    "\n",
    "- ratings.csv\n",
    "- movies.csv\n",
    "\n",
    "Alternatively, you can access the data here:\n",
    "\n",
    "- https://s3-us-west-2.amazonaws.com/recommender-tutorial/movies.csv\n",
    "- https://s3-us-west-2.amazonaws.com/recommender-tutorial/ratings.csv"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "ratings = pd.read_csv('https://s3-us-west-2.amazonaws.com/recommender-tutorial/ratings.csv')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "movies = pd.read_csv('https://s3-us-west-2.amazonaws.com/recommender-tutorial/movies.csv')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Step 3: Exploratory Data Analysis"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Number of ratings: 100004\n",
      "Number of unique movieId's: 9066\n",
      "Number of unique users: 671\n",
      "Average number of ratings per user: 149.04\n",
      "Average number of ratings per movie: 11.03\n"
     ]
    }
   ],
   "source": [
    "n_ratings = len(ratings)\n",
    "n_movies = ratings['movieId'].nunique()\n",
    "n_users = ratings['userId'].nunique()\n",
    "\n",
    "print(f\"Number of ratings: {n_ratings}\")\n",
    "print(f\"Number of unique movieId's: {n_movies}\")\n",
    "print(f\"Number of unique users: {n_users}\")\n",
    "print(f\"Average number of ratings per user: {round(n_ratings/n_users, 2)}\")\n",
    "print(f\"Average number of ratings per movie: {round(n_ratings/n_movies, 2)}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "sns.countplot(x=\"rating\", data=ratings, palette=\"viridis\")\n",
    "plt.title(\"Distribution of movie ratings\", fontsize=14)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Best vs. Worst Movie\n",
    "\n",
    "Which movie has the lowest and highest average rating?"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 61,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>movieId</th>\n",
       "      <th>title</th>\n",
       "      <th>genres</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>1062</th>\n",
       "      <td>1311</td>\n",
       "      <td>Santa with Muscles (1996)</td>\n",
       "      <td>Comedy</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "      movieId                      title  genres\n",
       "1062     1311  Santa with Muscles (1996)  Comedy"
      ]
     },
     "execution_count": 61,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "mean_ratings = ratings.groupby('movieId')[['rating']].mean()\n",
    "lowest_rated = mean_ratings['rating'].idxmin()\n",
    "movies.loc[movies['movieId'] == lowest_rated]\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "`Santa with Muscles` has the lowest average rating."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 72,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>movieId</th>\n",
       "      <th>title</th>\n",
       "      <th>genres</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>50</th>\n",
       "      <td>53</td>\n",
       "      <td>Lamerica (1994)</td>\n",
       "      <td>Adventure|Drama</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    movieId            title           genres\n",
       "50       53  Lamerica (1994)  Adventure|Drama"
      ]
     },
     "execution_count": 72,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "highest_rated = mean_ratings['rating'].idxmax()\n",
    "movies.loc[movies['movieId'] == highest_rated]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Lamerica may be the \"highest\" rated movie, but it only has one rating. A better approach for evaluating movie popularity is to do look at the [Bayesian average](https://en.wikipedia.org/wiki/Bayesian_average)."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Bayesian Average\n",
    "\n",
    "Bayesian Average is defined as:\n",
    "\n",
    "$r_{i} = \\frac{C \\times m + \\Sigma{\\text{reviews}}}{C+N}$\n",
    "\n",
    "where $C$ represents our confidence, $m$ represents our prior, and $N$ is the total number of reviews for movie $i$. In this case, our prior will be the average rating across all movies. By defintion, C represents \"the typical data set size\". Let's make $C$ be the average number of ratings for a given movie."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 64,
   "metadata": {},
   "outputs": [],
   "source": [
    "movie_stats = ratings.groupby('movieId')[['rating']].agg(['count', 'mean'])\n",
    "movie_stats.columns = movie_stats.columns.droplevel()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 65,
   "metadata": {},
   "outputs": [],
   "source": [
    "C = movie_stats['count'].mean()\n",
    "m = movie_stats['mean'].mean()\n",
    "\n",
    "def bayesian_avg(ratings):\n",
    "    bayesian_avg = (C*m+ratings.sum())/(C+ratings.count())\n",
    "    return bayesian_avg\n",
    "\n",
    "bayesian_avg_ratings = ratings.groupby('movieId')['rating'].agg(bayesian_avg).reset_index()\n",
    "bayesian_avg_ratings.columns = ['movieId', 'bayesian_avg']\n",
    "movie_stats = movie_stats.merge(bayesian_avg_ratings, on='movieId')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 73,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>movieId</th>\n",
       "      <th>count</th>\n",
       "      <th>mean</th>\n",
       "      <th>bayesian_avg</th>\n",
       "      <th>title</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>318</td>\n",
       "      <td>311</td>\n",
       "      <td>4.487138</td>\n",
       "      <td>4.446203</td>\n",
       "      <td>Shawshank Redemption, The (1994)</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>858</td>\n",
       "      <td>200</td>\n",
       "      <td>4.487500</td>\n",
       "      <td>4.425014</td>\n",
       "      <td>Godfather, The (1972)</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>50</td>\n",
       "      <td>201</td>\n",
       "      <td>4.370647</td>\n",
       "      <td>4.314534</td>\n",
       "      <td>Usual Suspects, The (1995)</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1221</td>\n",
       "      <td>135</td>\n",
       "      <td>4.385185</td>\n",
       "      <td>4.302614</td>\n",
       "      <td>Godfather: Part II, The (1974)</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>527</td>\n",
       "      <td>244</td>\n",
       "      <td>4.303279</td>\n",
       "      <td>4.259541</td>\n",
       "      <td>Schindler's List (1993)</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   movieId  count      mean  bayesian_avg                             title\n",
       "0      318    311  4.487138      4.446203  Shawshank Redemption, The (1994)\n",
       "1      858    200  4.487500      4.425014             Godfather, The (1972)\n",
       "2       50    201  4.370647      4.314534        Usual Suspects, The (1995)\n",
       "3     1221    135  4.385185      4.302614    Godfather: Part II, The (1974)\n",
       "4      527    244  4.303279      4.259541           Schindler's List (1993)"
      ]
     },
     "execution_count": 73,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "movie_stats = movie_stats.merge(movies[['movieId', 'title']])\n",
    "movie_stats.sort_values('bayesian_avg', ascending=False).head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Using the Bayesian average, we see that `Shawshank Redemption`, `The Godfather`, and `The Usual Suspects` are the most highly rated movies. This result makes much more sense since these movies are critically acclaimed films."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 71,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>movieId</th>\n",
       "      <th>count</th>\n",
       "      <th>mean</th>\n",
       "      <th>bayesian_avg</th>\n",
       "      <th>title</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2869</th>\n",
       "      <td>3593</td>\n",
       "      <td>19</td>\n",
       "      <td>1.210526</td>\n",
       "      <td>1.975099</td>\n",
       "      <td>Battlefield Earth (2000)</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1242</th>\n",
       "      <td>1556</td>\n",
       "      <td>23</td>\n",
       "      <td>1.652174</td>\n",
       "      <td>2.183723</td>\n",
       "      <td>Speed 2: Cruise Control (1997)</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2161</th>\n",
       "      <td>2701</td>\n",
       "      <td>47</td>\n",
       "      <td>2.031915</td>\n",
       "      <td>2.271446</td>\n",
       "      <td>Wild Wild West (1999)</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>489</th>\n",
       "      <td>546</td>\n",
       "      <td>17</td>\n",
       "      <td>1.735294</td>\n",
       "      <td>2.347912</td>\n",
       "      <td>Super Mario Bros. (1993)</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1243</th>\n",
       "      <td>1562</td>\n",
       "      <td>47</td>\n",
       "      <td>2.148936</td>\n",
       "      <td>2.366224</td>\n",
       "      <td>Batman &amp; Robin (1997)</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "      movieId  count      mean  bayesian_avg                           title\n",
       "2869     3593     19  1.210526      1.975099        Battlefield Earth (2000)\n",
       "1242     1556     23  1.652174      2.183723  Speed 2: Cruise Control (1997)\n",
       "2161     2701     47  2.031915      2.271446           Wild Wild West (1999)\n",
       "489       546     17  1.735294      2.347912        Super Mario Bros. (1993)\n",
       "1243     1562     47  2.148936      2.366224           Batman & Robin (1997)"
      ]
     },
     "execution_count": 71,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "movie_stats.sort_values('bayesian_avg', ascending=True).head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "With Bayesian average, it looks like `Battlefield Earth`, `Speed 2: Cruise Control` and `Wild Wild West` are the worst rated movies. `Santa with Muscles` isn't so bad after all."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Step 4: Data Pre-processing\n",
    "\n",
    "We are going to use a technique called colaborative filtering to generate recommendations for users. This technique is based on the premise that similar people like similar things. \n",
    "\n",
    "The first step is to transform our data into a user-item matrix, also known as a \"utility\" matrix. In this matrix, rows represent users and columns represent movies. The beauty of collaborative filtering is that it doesn't require any information about the users or the movies user to generate recommendations.\n",
    "\n",
    "<img src=\"imgs/user-movie-matrix.png\" width=60%/>\n",
    "\n",
    "The `create_X()` function outputs a sparse matrix X with four mapper dictionaries:\n",
    "\n",
    "- **user_mapper**: maps user id to user index\n",
    "- **movie_mapper**: maps movie id to movie index\n",
    "- **user_inv_mapper**: maps user index to user id\n",
    "- **movie_inv_mapper**: maps movie index to movie id\n",
    "\n",
    "We need these dictionaries because they map which row/column of the utility matrix corresponds to which user/movie id.\n",
    "\n",
    "Our X (user-item) matrix is a [scipy.sparse.csr_matrix](https://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.sparse.csr_matrix.html) which stores the data sparsely."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 81,
   "metadata": {},
   "outputs": [],
   "source": [
    "from utils import create_X\n",
    "\n",
    "X, user_mapper, movie_mapper, user_inv_mapper, movie_inv_mapper = create_X(ratings)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Evaluating sparsity"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 88,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Matrix sparsity: 1.64%\n"
     ]
    }
   ],
   "source": [
    "n_total = X.shape[0]*X.shape[1]\n",
    "n_ratings = X.nnz\n",
    "sparsity = n_ratings/n_total\n",
    "print(f\"Matrix sparsity: {round(sparsity*100,2)}%\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "`csr_matrix.nnz` gets the count of stored values in our sparse matrix. The rest of our cells are empty cells.\n",
    "\n",
    "The **cold start problem** is when there are new users and movies in our matrix that do not have any ratings. In our Movielens dataset, all users and movies have at least one rating."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Step 5: Item-item Recommendations with k-Nearest Neighbors"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "We are going to find the $k$ movies that have the most similar user engagement vectors for movie $i$."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Part 2: Top N recommender"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
